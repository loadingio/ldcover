!function(){var i,o;function n(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}i=function(t,e,n){var r;for(null==n&&(n=document),r=t;r&&r!==n;)r=r.parentNode;if(r!==n)return null;for(r=t;r&&r!==n&&r.matches&&!r.matches(e);)r=r.parentNode;return r!==n||n.matches&&n.matches(e)?r:null},(o=function(t){var e;return null==t&&(t={}),this.evtHandler={},this.opt=n({delay:300,autoZ:!0,baseZ:3e3,escape:!0,byDisplay:!0},t),t.zmgr&&this.zmgr(t.zmgr),this.promises=[],this._r=t.root?"string"==typeof t.root?document.querySelector(t.root):t.root:((e=document.createElement("div")).innerHTML='<div class="base"></div>',e),this.cls="string"==typeof t.type?t.type.split(" "):t.type,this.resident=null!=t.resident&&t.resident,this.inPlace=null==t.inPlace||t.inPlace,this.container="string"==typeof t.container?document.querySelector(t.container):t.container,this._r.content&&this._r.content.nodeType===Element.DOCUMENT_FRAGMENT_NODE||this.init(),this}).prototype=n(Object.create(Object.prototype),{root:function(){return this.inited||this.init(),this._r},init:function(){var t,n,r=this;if(!this.inited)return this.inited=!0,this.inPlace||(this._r.parentNode.removeChild(this._r),document.body.appendChild(this._r)),!this.resident&&this._r.parentNode&&(this._c=document.createComment(" ldcover placeholder "),this._r.parentNode.insertBefore(this._c,this._r),this._r.parentNode.removeChild(this._r)),this._r.content&&this._r.content.nodeType===Element.DOCUMENT_FRAGMENT_NODE&&(this._r=this._r.content.cloneNode(!0).childNodes[0],this._r.parentNode.removeChild(this._r)),(t=this._r.getAttribute("data-lock"))&&"true"===t&&(this.opt.lock=!0),this.inner=this._r.querySelector(".inner"),this.base=this._r.querySelector(".base"),this._r.classList.add.apply(this._r.classList,["ldcv"].concat(this.cls||[])),this.opt.byDisplay&&(this._r.style.display="none"),n=null,this._r.addEventListener("mousedown",function(t){return n=t.target}),this._r.addEventListener("click",function(t){var e;return n!==r._r||r.opt.lock?i(t.target,"*[data-ldcv-cancel]",r._r)?r.cancel():(t=i(t.target,"*[data-ldcv-set]",r._r))&&null!=(e=t.getAttribute("data-ldcv-set"))&&!i(t,".disabled",r._r)?r.set(e):void 0:r.toggle(!1)})},zmgr:function(t){return null!=t?this._zmgr=t:this._zmgr},append:function(t){var e=this._r.childNodes[0];return(e&&e.classList.contains("base")?e:this._r).appendChild(t)},get:function(n){var r=this;return new Promise(function(t,e){return r.promises.push({res:t,rej:e}),r.toggle(!0,n)})},cancel:function(e,t){if(null==t&&(t=!0),this.promises.splice(0).map(function(t){return t.rej(e||((t=new Error).name="lderror",t.id=999,t))}),t)return this.toggle(!1)},set:function(e,t){if(null==t&&(t=!0),this.promises.splice(0).map(function(t){return t.res(e)}),t)return this.toggle(!1)},isOn:function(){return this._r.classList.contains("active")},lock:function(){return this.opt.lock=!0},toggle:function(e,i){var s=this;return new Promise(function(n,t){var r;return s.inited||s.init(),e&&null!=i&&s.fire("data",i),null==e&&s._r.classList.contains("running")||null!=e&&s._r.classList.contains("active")===!!e?n():((r=null!=e?e:!s._r.classList.contains("active"))&&!s._r.parentNode&&(null==s.container&&s._c&&s._c.parentNode?s._c.parentNode.insertBefore(s._r,s._c):(s.container||document.body).appendChild(s._r)),s._r.classList.add("running"),s.opt.byDisplay&&(s._r.style.display="block"),s._r.classList.contains("inline")&&(r?(s.h=function(t){if(!s._r.contains(t.target))return s.toggle(!1)},window.addEventListener("click",s.h)):s.h&&window.removeEventListener("click",s.h)),setTimeout(function(){var e,t;return s._r.classList.toggle("active",r),!s.opt.lock&&s.opt.escape&&r&&(e=function(t){if(27===t.keyCode&&(t=o.popups)[t.length-1]===s)return s.toggle(!1),document.removeEventListener("keyup",e)},document.addEventListener("keyup",e)),s.opt.animation&&s.inner&&s.inner.classList[r?"add":"remove"].apply(s.inner.classList,s.opt.animation.split(" ")),r?o.popups.push(s):0<=(t=o.popups.indexOf(s))&&o.popups.splice(t,1),s.opt.autoZ&&(r?s._r.style.zIndex=s.z=(s._zmgr||o._zmgr).add(s.opt.baseZ):((s._zmgr||o._zmgr).remove(s.z),delete s.z)),s.opt.transformFix&&!r&&s._r.classList.remove("shown"),setTimeout(function(){if(s._r.classList.remove("running"),s.opt.transformFix&&r&&s._r.classList.add("shown"),!r&&s.opt.byDisplay&&(s._r.style.display="none"),r||!s._r.parentNode||s.resident||s._r.parentNode.removeChild(s._r),!r&&s.opt.autoZ)return s._r.style.zIndex=""},s.opt.delay),s.promises.length&&!r&&s.set(void 0,!1),s.fire("toggle."+(r?"on":"off")),n()},50))})},on:function(t,n){var r=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=r.evtHandler)[t]||(e[t]=[])).push(n)})},fire:function(t){for(var e,n,r,i,s=[],o=[],a=1,l=arguments.length;a<l;++a)o.push(arguments[a]);for(e=o,a=0,r=(n=this.evtHandler[t]||[]).length;a<r;++a)i=n[a],s.push(i.apply(this,e));return s}}),n(o,{popups:[],_zmgr:{add:function(t){return(this.s||(this.s=[])).push(t=Math.max(t||0,((t=this.s)[t.length-1]||0)+1)),t},remove:function(t){if(!((t=(this.s||(this.s=[])).indexOf(t))<0))return this.s.splice(t,1)}},zmgr:function(t){return null!=t?this._zmgr=t:this._zmgr}}),"undefined"!=typeof module&&null!==module?module.exports=o:window&&(window.ldcover=o)}.call(this);
