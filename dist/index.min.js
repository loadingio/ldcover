!function(){var s,o;function n(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}s=function(t,e,n){var r;for(null==n&&(n=document),r=t;r&&r!==n;)r=r.parentNode;if(r!==n)return null;for(r=t;r&&r!==n&&r.matches&&!r.matches(e);)r=r.parentNode;return r!==n||n.matches&&n.matches(e)?r:null},(o=function(t){var e;return null==t&&(t={}),this.evtHandler={},this.opt=n({delay:300,autoZ:!0,baseZ:3e3,escape:!0,byDisplay:!0},t),t.zmgr&&this.zmgr(t.zmgr),this.promises=[],this._r=t.root?"string"==typeof t.root?document.querySelector(t.root):t.root:((e=document.createElement("div")).innerHTML='<div class="base"></div>',e),this.cls="string"==typeof t.type?t.type.split(" "):t.type,this.resident=null!=t.resident&&t.resident,this.inPlace=null==t.inPlace||t.inPlace,this.container="string"==typeof t.container?document.querySelector(t.container):t.container,this._r.content&&this._r.content.nodeType===Element.DOCUMENT_FRAGMENT_NODE||this.init(),this}).prototype=n(Object.create(Object.prototype),{root:function(){return this.inited||this.init(),this._r},init:function(){var t,r,i=this;if(!this.inited)return this.inited=!0,this.inPlace||(this._r.parentNode.removeChild(this._r),document.body.appendChild(this._r)),!this.resident&&this._r.parentNode&&(this._c=document.createComment(" ldcover placeholder "),this._r.parentNode.insertBefore(this._c,this._r),this._r.parentNode.removeChild(this._r)),this._r.content&&this._r.content.nodeType===Element.DOCUMENT_FRAGMENT_NODE&&(this._r=this._r.content.cloneNode(!0).childNodes[0],this._r.parentNode.removeChild(this._r)),(t=this._r.getAttribute("data-lock"))&&"true"===t&&(this.opt.lock=!0),this.inner=this._r.querySelector(".inner"),this.base=this._r.querySelector(".base"),this._r.classList.add.apply(this._r.classList,["ldcv"].concat(this.cls||[])),this.opt.byDisplay&&(this._r.style.display="none"),r=null,this._r.addEventListener("mousedown",this.el_md=function(t){return r=t.target}),this._r.addEventListener("click",this.el_c=function(t){var e,n;return r!==i._r||i.opt.lock?s(t.target,"*[data-ldcv-cancel]",i._r)?(t.stopPropagation(),i.cancel()):(e=s(t.target,"*[data-ldcv-set]",i._r))&&null!=(n=e.getAttribute("data-ldcv-set"))&&!s(e,".disabled",i._r)?(t.stopPropagation(),i.set(n)):void 0:(t.stopPropagation(),i.toggle(!1))})},zmgr:function(t){return null!=t?this._zmgr=t:this._zmgr},append:function(t){var e=this._r.childNodes[0];return(e&&e.classList.contains("base")?e:this._r).appendChild(t)},get:function(n){var r=this;return new Promise(function(t,e){return r.promises.push({res:t,rej:e}),r.toggle(!0,n)})},cancel:function(e,t){if(null==t&&(t=!0),this.promises.splice(0).map(function(t){return t.rej(e||((t=new Error).name="lderror",t.id=999,t))}),t)return this.toggle(!1)},set:function(e,t){if(null==t&&(t=!0),this.promises.splice(0).map(function(t){return t.res(e)}),t)return this.toggle(!1)},isOn:function(){return this._r.classList.contains("active")},lock:function(){return this.opt.lock=!0},toggle:function(r,i){var s=this;return new Promise(function(e,t){var n;return s.inited||s.init(),r&&null!=i&&s.fire("data",i),null==r&&s._r.classList.contains("running")||null!=r&&s._r.classList.contains("active")===!!r?e():((n=null!=r?r:!s._r.classList.contains("active"))&&!s._r.parentNode&&(null==s.container&&s._c&&s._c.parentNode?s._c.parentNode.insertBefore(s._r,s._c):(s.container||document.body).appendChild(s._r)),s._r.classList.add("running"),s.opt.byDisplay&&(s._r.style.display="block"),s._r.classList.contains("inline")&&(n?(s.el_h=function(t){if(!s._r.contains(t.target))return s.toggle(!1)},window.addEventListener("click",s.el_h)):s.el_h&&(window.removeEventListener("click",s.el_h),s.el_h=null)),!n&&s.el_esc&&(document.removeEventListener("keyup",s.el_esc),s.el_esc=null),setTimeout(function(){var t;return s._r.classList.toggle("active",n),!s.opt.lock&&s.opt.escape&&n&&!s.el_esc&&(s.el_esc=function(t){if(27===t.keyCode&&(t=o.popups)[t.length-1]===s)return s.toggle(!1)},document.addEventListener("keyup",s.el_esc)),s.opt.animation&&s.inner&&s.inner.classList[n?"add":"remove"].apply(s.inner.classList,s.opt.animation.split(" ")),n?o.popups.push(s):0<=(t=o.popups.indexOf(s))&&o.popups.splice(t,1),s.opt.autoZ&&(n?s._r.style.zIndex=s.z=(s._zmgr||o._zmgr).add(s.opt.baseZ):((s._zmgr||o._zmgr).remove(s.z),delete s.z)),s.opt.transformFix&&!n&&s._r.classList.remove("shown"),setTimeout(function(){return s._r.classList.remove("running"),s.opt.transformFix&&n&&s._r.classList.add("shown"),!n&&s.opt.byDisplay&&(s._r.style.display="none"),n||!s._r.parentNode||s.resident||s._r.parentNode.removeChild(s._r),!n&&s.opt.autoZ&&(s._r.style.zIndex=""),s.fire("toggled."+(n?"on":"off"))},s.opt.delay),s.promises.length&&!n&&s.set(void 0,!1),s.fire("toggle."+(n?"on":"off")),e()},50))})},on:function(t,n){var r=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=r.evtHandler)[t]||(e[t]=[])).push(n)})},fire:function(t){for(var e,n,r,i,s=[],o=[],l=1,c=arguments.length;l<c;++l)o.push(arguments[l]);for(e=o,l=0,r=(n=this.evtHandler[t]||[]).length;l<r;++l)i=n[l],s.push(i.apply(this,e));return s},destroy:function(){var t=this;return this.toggle(!1).then(function(){return t._c&&(t._c.parentNode.insertBefore(t._r,t._c),t._c.parentNode.removeChild(t._c)),t._r.removeEventListener("mousedown",t.el_md),t._r.removeEventListener("click",t.el_c)})}}),n(o,{popups:[],_zmgr:{add:function(t){return(this.s||(this.s=[])).push(t=Math.max(t||0,((t=this.s)[t.length-1]||0)+1)),t},remove:function(t){if(!((t=(this.s||(this.s=[])).indexOf(t))<0))return this.s.splice(t,1)}},zmgr:function(t){return null!=t?this._zmgr=t:this._zmgr}}),"undefined"!=typeof module&&null!==module?module.exports=o:window&&(window.ldcover=o)}.call(this);
