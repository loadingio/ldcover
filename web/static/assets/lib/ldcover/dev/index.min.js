(function(){function t(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}var e,n;e=function(t,e,n){var r;for(null==n&&(n=document),r=t;r&&r!==n;)r=r.parentNode;if(r!==n)return null;for(r=t;r&&r!==n&&r.matches&&!r.matches(e);)r=r.parentNode;return r!==n||n.matches&&n.matches(e)?r:null},(n=function(e){var n;return null==e&&(e={}),this.evtHandler={},this.opt=t({delay:300,autoZ:!0,baseZ:3e3,escape:!0,byDisplay:!0},e),e.zmgr&&this.zmgr(e.zmgr),this.promises=[],this._r=e.root?"string"==typeof e.root?document.querySelector(e.root):e.root:(n=document.createElement("div"),n.innerHTML='<div class="base"></div>',n),this.cls="string"==typeof e.type?e.type.split(" "):e.type,this.resident=null!=e.resident&&e.resident,this.container="string"==typeof e.container?document.querySelector(e.container):e.container,this._r.content&&this._r.content.nodeType===Element.DOCUMENT_FRAGMENT_NODE||this.init(),this}).prototype=t(Object.create(Object.prototype),{root:function(){return this.inited||this.init(),this._r},init:function(){var t,n,r=this;if(!this.inited)return this.inited=!0,!this.resident&&this._r.parentNode&&(this._c=document.createComment(" ldcover placeholder "),this._r.parentNode.insertBefore(this._c,this._r),this._r.parentNode.removeChild(this._r)),this._r.content&&this._r.content.nodeType===Element.DOCUMENT_FRAGMENT_NODE&&(this._r=this._r.content.cloneNode(!0).childNodes[0],this._r.parentNode.removeChild(this._r)),(t=this._r.getAttribute("data-lock"))&&"true"===t&&(this.opt.lock=!0),this.inner=this._r.querySelector(".inner"),this.base=this._r.querySelector(".base"),this._r.classList.add.apply(this._r.classList,["ldcv"].concat(this.cls||[])),this.opt.byDisplay&&(this._r.style.display="none"),n=null,this._r.addEventListener("mousedown",function(t){return n=t.target}),this._r.addEventListener("click",function(t){var i,s;return n!==r._r||r.opt.lock?e(t.target,"*[data-ldcv-cancel]",r._r)?r.cancel():(i=e(t.target,"*[data-ldcv-set]",r._r))&&null!=(s=i.getAttribute("data-ldcv-set"))&&!e(i,".disabled",r._r)?r.set(s):void 0:r.toggle(!1)})},zmgr:function(t){return null!=t?this._zmgr=t:this._zmgr},append:function(t){var e;return((e=this._r.childNodes[0])&&e.classList.contains("base")?e:this._r).appendChild(t)},get:function(){var t=this;return new Promise(function(e,n){return t.promises.push({res:e,rej:n}),t.toggle(!0)})},cancel:function(t,e){if(null==e&&(e=!0),this.promises.splice(0).map(function(e){var n;return e.rej(t||(n=new Error,n.name="lderror",n.id=999,n))}),e)return this.toggle(!1)},set:function(t,e){if(null==e&&(e=!0),this.promises.splice(0).map(function(e){return e.res(t)}),e)return this.toggle(!1)},isOn:function(){return this._r.classList.contains("active")},lock:function(){return this.opt.lock=!0},toggle:function(t){var e=this;return new Promise(function(r,i){var s;return e.inited||e.init(),null==t&&e._r.classList.contains("running")?r():null!=t&&e._r.classList.contains("active")===!!t?r():((s=null!=t?t:!e._r.classList.contains("active"))&&!e._r.parentNode&&(null==e.container&&e._c&&e._c.parentNode?e._c.parentNode.insertBefore(e._r,e._c):(e.container||document.body).appendChild(e._r)),e._r.classList.add("running"),e.opt.byDisplay&&(e._r.style.display="block"),e._r.classList.contains("inline")&&(s?(e.h=function(t){if(!e._r.contains(t.target))return e.toggle(!1)},window.addEventListener("click",e.h)):e.h&&window.removeEventListener("click",e.h)),setTimeout(function(){var t,i;return e._r.classList.toggle("active",s),!e.opt.lock&&e.opt.escape&&s&&(t=function(r){var i;if(27===r.keyCode){if((i=n.popups)[i.length-1]!==e)return;return e.toggle(!1),document.removeEventListener("keyup",t)}},document.addEventListener("keyup",t)),e.opt.animation&&e.inner&&e.inner.classList[s?"add":"remove"].apply(e.inner.classList,e.opt.animation.split(" ")),s?n.popups.push(e):(i=n.popups.indexOf(e))>=0&&n.popups.splice(i,1),e.opt.autoZ&&(s?e._r.style.zIndex=e.z=(e._zmgr||n._zmgr).add(e.opt.baseZ):((e._zmgr||n._zmgr).remove(e.z),delete e.z,e._r.style.zIndex="")),e.opt.transformFix&&!s&&e._r.classList.remove("shown"),setTimeout(function(){if(e._r.classList.remove("running"),e.opt.transformFix&&s&&e._r.classList.add("shown"),!s&&e.opt.byDisplay&&(e._r.style.display="none"),!s&&e._r.parentNode&&!e.resident)return e._r.parentNode.removeChild(e._r)},e.opt.delay),e.promises.length&&!s&&e.set(void 0,!1),e.fire("toggle."+(s?"on":"off")),r()},50))})},on:function(t,e){var n=this;return(Array.isArray(t)?t:[t]).map(function(t){var r;return((r=n.evtHandler)[t]||(r[t]=[])).push(e)})},fire:function(t){var e,n,r,i,s,o,a,l=[];for(n=[],r=1,i=arguments.length;r<i;++r)n.push(arguments[r]);for(e=n,r=0,o=(s=this.evtHandler[t]||[]).length;r<o;++r)a=s[r],l.push(a.apply(this,e));return l}}),t(n,{popups:[],_zmgr:{add:function(t){var e,n;return(this.s||(this.s=[])).push(e=Math.max(t||0,((n=this.s)[n.length-1]||0)+1)),e},remove:function(t){var e;if(!((e=(this.s||(this.s=[])).indexOf(t))<0))return this.s.splice(e,1)}},zmgr:function(t){return null!=t?this._zmgr=t:this._zmgr}}),"undefined"!=typeof module&&null!==module?module.exports=n:window&&(window.ldcover=n)}).call(this);
